<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI 量化交易终端</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%230d1117'/><text x='16' y='22' text-anchor='middle' font-size='18' fill='%2358a6ff'>Q</text></svg>">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
</head>
<body>

  <!-- ===== TOP NAV ===== -->
  <nav class="nav">
    <div class="nav-left">
      <div class="nav-brand">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
        <span>AI 量化终端</span>
      </div>
    </div>
    <div class="nav-center">
      <div class="nav-status-group">
        <button id="mode-toggle" class="badge badge-testnet" onclick="toggleMode()" title="点击切换测试网/实盘">
          <span class="badge-dot"></span>测试网
        </button>
        <span id="status-badge" class="badge badge-stopped">
          <span class="badge-dot"></span>已停止
        </span>
        <span id="ws-badge" class="badge badge-ws">
          <span class="badge-dot"></span>WS: --
        </span>
        <span id="ai-model-badge" class="badge badge-ws">战略AI: --</span>
        <span id="ai-tactical-badge" class="badge badge-ws">战术AI: --</span>
      </div>
    </div>
    <div class="nav-right">
      <button class="btn btn-success" onclick="api('/api/start','POST')">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        启动
      </button>
      <button class="btn" onclick="api('/api/stop','POST')">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>
        停止
      </button>
      <button class="btn btn-danger" onclick="if(confirm('确认紧急停止？将平掉所有仓位！'))api('/api/emergency-stop','POST')">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
        紧急停止
      </button>
      <button class="btn btn-outline" onclick="api('/api/circuit/reset','POST')">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
        重置熔断
      </button>
    </div>
  </nav>

  <!-- ===== TICKER BAR ===== -->
  <div class="ticker-bar" id="ticker-bar">
    <div class="ticker-item">
      <span class="ticker-name">BTC</span>
      <span class="ticker-price" id="tick-BTC">--</span>
      <span class="ticker-change" id="tick-change-BTC"></span>
    </div>
    <div class="ticker-item">
      <span class="ticker-name">ETH</span>
      <span class="ticker-price" id="tick-ETH">--</span>
      <span class="ticker-change" id="tick-change-ETH"></span>
    </div>
    <div class="ticker-item">
      <span class="ticker-name">SOL</span>
      <span class="ticker-price" id="tick-SOL">--</span>
      <span class="ticker-change" id="tick-change-SOL"></span>
    </div>
    <div class="ticker-item">
      <span class="ticker-name">BNB</span>
      <span class="ticker-price" id="tick-BNB">--</span>
      <span class="ticker-change" id="tick-change-BNB"></span>
    </div>
    <div class="ticker-item">
      <span class="ticker-name">XRP</span>
      <span class="ticker-price" id="tick-XRP">--</span>
      <span class="ticker-change" id="tick-change-XRP"></span>
    </div>
    <div class="ticker-item">
      <span class="ticker-name">DOGE</span>
      <span class="ticker-price" id="tick-DOGE">--</span>
      <span class="ticker-change" id="tick-change-DOGE"></span>
    </div>
    <div class="ticker-sep"></div>
    <div class="ticker-item" id="active-pairs-bar">
      <span class="ticker-name">交易对</span>
      <span class="ticker-pairs" id="active-pairs-list">--</span>
    </div>
  </div>

  <!-- ===== STATS GRID ===== -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon stat-icon-balance">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M2 10h20"/></svg>
      </div>
      <div class="stat-info">
        <div class="stat-label">总余额</div>
        <div class="stat-value" id="total-balance">--</div>
        <div class="stat-sub">USDT</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon stat-icon-available">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
      </div>
      <div class="stat-info">
        <div class="stat-label">可用余额</div>
        <div class="stat-value" id="avail-balance">--</div>
        <div class="stat-sub">USDT</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon stat-icon-daily">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
      </div>
      <div class="stat-info">
        <div class="stat-label">今日盈亏</div>
        <div class="stat-value" id="daily-pnl">--</div>
        <div class="stat-sub" id="daily-pnl-pct">--</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon stat-icon-unrealized">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
      </div>
      <div class="stat-info">
        <div class="stat-label">未实现盈亏</div>
        <div class="stat-value" id="unrealized-pnl">--</div>
        <div class="stat-sub" id="position-count">0 个持仓</div>
      </div>
    </div>
  </div>

  <!-- ===== MAIN CONTENT ===== -->
  <div class="main">
    <div class="content">
      <!-- Equity Chart -->
      <div class="chart-wrap">
        <div class="section-header">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/></svg>
          <span>权益曲线</span>
        </div>
        <div class="chart-container"><canvas id="equity-chart"></canvas></div>
      </div>

      <!-- Tabs: Positions / Trades / Position History -->
      <div class="tabs">
        <button class="tab active" onclick="showPanel('positions',this)">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
          当前持仓
        </button>
        <button class="tab" onclick="showPanel('trades',this)">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>
          最近交易
        </button>
        <button class="tab" onclick="showPanel('pos-history',this)">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          持仓历史
        </button>
      </div>
      <div id="panel-positions" class="table-panel">
        <table>
          <thead><tr><th>交易对</th><th>方向</th><th>数量</th><th>开仓价</th><th>标记价</th><th>盈亏</th><th>杠杆</th></tr></thead>
          <tbody id="positions-body"><tr><td colspan="7" class="empty-row">暂无持仓</td></tr></tbody>
        </table>
      </div>
      <div id="panel-trades" class="table-panel" style="display:none">
        <table>
          <thead><tr><th>时间</th><th>交易对</th><th>操作</th><th>方向</th><th>数量</th><th>价格</th><th>置信度</th></tr></thead>
          <tbody id="trades-body"><tr><td colspan="7" class="empty-row">暂无交易记录</td></tr></tbody>
        </table>
      </div>
      <div id="panel-pos-history" class="table-panel" style="display:none">
        <table>
          <thead><tr><th>开仓时间</th><th>交易对</th><th>方向</th><th>数量</th><th>入场价</th><th>出场价</th><th>盈亏</th><th>状态</th></tr></thead>
          <tbody id="pos-history-body"><tr><td colspan="8" class="empty-row">暂无历史记录</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- ===== SIDEBAR ===== -->
    <div class="sidebar">
      <!-- Circuit Breaker -->
      <div class="sidebar-section">
        <div class="section-header">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          <span>熔断器状态</span>
        </div>
        <div class="circuit-box">
          <div class="circuit-status positive" id="circuit-status">
            <span class="circuit-dot"></span>正常
          </div>
          <div class="circuit-detail" id="circuit-detail">--</div>
        </div>
      </div>

      <!-- AI Analysis History (virtual scroll) -->
      <div class="sidebar-section sidebar-section-grow">
        <div class="section-header">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a4 4 0 0 1 4 4c0 1.95-1.4 3.58-3.25 3.93"/><path d="M12 2a4 4 0 0 0-4 4c0 1.95 1.4 3.58 3.25 3.93"/><path d="M12 18v4"/><path d="M8 22h8"/><path d="M12 10v8"/><circle cx="12" cy="6" r="1"/></svg>
          <span>AI 分析思路</span>
          <span class="analysis-count" id="analysis-count">0</span>
        </div>
        <div class="ai-history-viewport" id="ai-history-viewport">
          <div class="ai-history-sentinel" id="ai-history-sentinel"></div>
          <div class="ai-history-content" id="ai-history-content">
            <div class="ai-waiting">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
              等待 AI 分析中...
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
